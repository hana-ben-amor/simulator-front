<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light nav-white sticky-top">
  <div class="container-xxl">
    <!-- Brand -->
    <a class="navbar-brand d-flex align-items-center gap-2" routerLink="/dashboard">
      <img src="logo.png" alt="ROI Simulator" class="brand-logo" />
    </a>


    <!-- Toggler mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
            aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Menu -->
    <div class="collapse navbar-collapse" id="mainNav">
    

  <ul class="navbar-nav ms-auto d-flex flex-row gap-2">
    <li class="nav-item">
      <button class="btn btn-chat d-flex align-items-center gap-2"
              data-bs-toggle="offcanvas" data-bs-target="#aiChat">
        <i class="bi bi-robot"></i>
        Chat
      </button>
    </li>
    <li class="nav-item">
      <button class="btn btn-export d-flex align-items-center gap-2" (click)="exportPdf()">
        <i class="bi bi-filetype-pdf"></i>
        Export PDF
      </button>
    </li>
  </ul>

    </div>
  </div>
</nav>
<!-- HERO / SLIDER -->
<div class="container-xxl mt-3">
  <div id="heroCarousel"
     class="carousel slide carousel-fade hero-carousel"
     data-bs-ride="carousel"
     data-bs-interval="4500"
     data-bs-touch="true"
     data-bs-pause="false"
     data-bs-wrap="true">
    <div class="carousel-indicators">
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
    </div>

    <div class="carousel-inner rounded-4 shadow-sm">
      <!-- Slide 1 -->
      <div class="carousel-item active">
        <img src="banniere1.png" class="d-block w-100" alt="Invest smart">

      </div>

      <!-- Slide 2 -->
      <div class="carousel-item">
        <img src="banniere2.png" class="d-block w-100" alt="Market data">

      </div>

      <!-- Slide 3 -->
      <div class="carousel-item">
        <img src="banniere3.png" class="d-block w-100" alt="Scenario planning">
      </div>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>
<section class="about-section container-xxl my-5">

<div class="row g-4 p-3">
  <!-- Card 1 -->
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card stat-card shade-1 h-100 text-center p-4 shadow-sm">
      <div class="icon mb-3"><i class="bi bi-lightning-charge-fill"></i></div>
      <h3 class="stat-value">+45%</h3>
      <p class="stat-label">D√©cisions plus rapides gr√¢ce √† l‚ÄôIA</p>
    </div>
  </div>

  <!-- Card 2 -->
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card stat-card shade-2 h-100 text-center p-4 shadow-sm">
      <div class="icon mb-3"><i class="bi bi-graph-up-arrow"></i></div>
      <h3 class="stat-value">92%</h3>
      <p class="stat-label">Taux de pr√©cision des simulations</p>
    </div>
  </div>

  <!-- Card 3 -->
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card stat-card shade-3 h-100 text-center p-4 shadow-sm">
      <div class="icon mb-3"><i class="bi bi-people-fill"></i></div>
      <h3 class="stat-value">+10K</h3>
      <p class="stat-label">Utilisateurs qui nous font confiance</p>
    </div>
  </div>

  <!-- Card 4 -->
  <div class="col-12 col-md-6 col-lg-3">
    <div class="card stat-card shade-4 h-100 text-center p-4 shadow-sm">
      <div class="icon mb-3"><i class="bi bi-clock-history"></i></div>
      <h3 class="stat-value">60s</h3>
      <p class="stat-label">Temps moyen pour obtenir un ROI</p>
    </div>
  </div>
</div>
</section>
<!-- Fl√®che verticale fixe (scroll to simulation) -->
<button class="go-sim" (click)="scrollToSimulation()" aria-label="Go to simulator">
  <i class="bi bi-chevron-double-down"></i>
</button>

<!-- CONTENU -->
<div id="simulation" class="dashboard container-xxl py-4">
  <header class="dashboard-header d-flex justify-content-between align-items-center rounded-4 p-4 shadow-sm mb-3">
  <h2 class="m-0 fw-bold typewriter-wrap">
    <span class="typewriter">{{ displayedText }}</span>
    <span class="cursor" aria-hidden="true">|</span>
  </h2>
  
  <div class="display-6 m-0">{{ simResult?.monthlyRevenue | number:'1.0-0' }} ‚Ç¨</div>
</header>
<!-- Empty state: shown until a simulation is available -->
<div *ngIf="!simResult" class="card border-0 shadow-sm rounded-4 my-3">
  <div class="card-body d-flex align-items-center gap-3">
    <i class="bi bi-info-circle text-primary fs-4"></i>
    <div class="text-muted">
      Veuillez choisir une <b>ville</b>, un <b>type</b> et une <b>surface</b> pour afficher la rentabilit√©.
    </div>
  </div>
</div>

  <!-- Filtres -->
  <div class="bg-white rounded-4 shadow-sm p-3 mb-3">
    <div class="row g-3">
      <div class="col-md-3">
        <select [(ngModel)]="selectedCity" class="form-select form-select-lg" (change)="loadData()">
          <option *ngFor="let city of cities" [value]="city">{{city}}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select [(ngModel)]="selectedRooms" class="form-select form-select-lg" (change)="loadData()">
          <option value="T1">T1</option>
          <option value="T2">T2</option>
          <option value="T3">T3</option>
          <option value="T4">T4</option>
          <option value="STUDIO">Studio</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="number"
              [(ngModel)]="price"
              class="form-control form-control-lg"
              (change)="loadData()"
              placeholder="Prix (‚Ç¨)" />
      </div>

      <div class="col-md-3">
        <input type="number" [(ngModel)]="surface" class="form-control form-control-lg"
            (change)="loadData()" placeholder="Surface (m¬≤)" />
      </div>
          <div class="col-md-3">
      <select [(ngModel)]="exploitationType" class="form-select form-select-lg" (change)="loadData()">
        <option value="LLD">Longue dur√©e</option>
        <option value="COURTE">Courte dur√©e (Airbnb)</option>
      </select>
    </div>
    </div>
  </div>

  <!-- KPI Cards -->
<div class="row g-3">
  <!-- Total Investment -->
  <div class="col-12 col-lg-4" *ngIf="simResult">
    <div class="kpi kpi-primary rounded-4 shadow-sm p-4 h-100 d-flex justify-content-between align-items-center">
      <div>
        <div class="kpi-label text-white-50">Total Investment</div>
        <div class="kpi-value text-white">{{ simResult.totalInvestment | number:'1.0-0' }} ‚Ç¨</div>
        <div class="kpi-sub text-white-50">incl. fees & works</div>
      </div>
      <i class="bi bi-bank2 fs-1 text-white-50"></i>
    </div>
  </div>

<!-- Monthly Revenue -->
<div class="col-12 col-lg-4" *ngIf="simResult">
  <div class="kpi rounded-4 shadow-sm p-4 h-100 bg-white d-flex justify-content-between align-items-center">
    <div>
      <div class="kpi-label text-muted">Monthly Revenue</div>
      <div class="kpi-value text-brand-700">
        {{ simResult.monthlyRevenue | number:'1.0-0' }} ‚Ç¨
      </div>
      <div class="kpi-sub text-muted">estimated</div>
    </div>
    <i class="bi bi-cash-coin fs-1 icon-brand-700"></i>
  </div>
</div>

<!-- Gross Yield -->
<div class="col-12 col-lg-4" *ngIf="simResult">
  <div class="kpi rounded-4 shadow-sm p-4 h-100 bg-white d-flex justify-content-between align-items-center">
    <div>
      <div class="kpi-label text-muted">Gross Yield</div>
      <div class="kpi-value text-brand-500">
        {{ simResult.grossYieldPct | number:'1.2-2' }} %
      </div>
      <div class="kpi-sub text-muted">annualized</div>
    </div>
    <i class="bi bi-percent fs-1 icon-brand-500"></i>
  </div>
</div>


  <!-- Rent table -->
  <div class="card mt-4 shadow-sm border-0 rounded-4" *ngIf="rentData">
    <div class="card-body p-4">
      <h5 class="fw-bold text-brand mb-3">üèòÔ∏è Long Term Rent Data</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
          <tr>
            <th>City</th>
            <th class="text-center">Rent/m¬≤</th>
            <th class="text-end">Source</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td class="fw-medium">{{ rentData.city }}</td>
            <td class="text-center">{{ rentData.rentPerM2 }} ‚Ç¨/m¬≤</td>
            <td class="text-end">{{ rentData.source }}</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>


</div>
<!-- AI Chat (Offcanvas) -->
<div class="offcanvas offcanvas-end ai-chat" tabindex="-1" id="aiChat" aria-labelledby="aiChatLabel">
  <div class="offcanvas-header">
    <h5 id="aiChatLabel" class="m-0 d-flex align-items-center gap-2">
      <i class="bi bi-robot"></i> Copilot
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body d-flex flex-column">
    <div class="small text-muted mb-2">
      Context: {{ selectedCity }} ‚Ä¢ {{ selectedRooms }} ‚Ä¢ {{ surface }} m¬≤
    </div>

    <div #scrollArea class="flex-grow-1 overflow-auto pe-2">
      <div *ngFor="let m of thread" class="mb-3 msg" [ngClass]="m.role">
        <div class="bubble">{{ m.text }}</div>
      </div>
      <div *ngIf="loading" class="text-center text-muted">
        <div class="spinner-border spinner-border-sm me-2"></div>Thinking‚Ä¶
      </div>
    </div>

    <form (ngSubmit)="send()" class="mt-3 d-flex gap-2">
      <input class="form-control" [(ngModel)]="draft" name="draft" placeholder="Ask the copilot‚Ä¶" [disabled]="loading" />
        <button class="btn btn-primary" type="submit" [disabled]="loading || !draft.trim()">

        <i class="bi bi-send"></i>
      </button>
    </form>
  </div>
</div>
<app-optimize></app-optimize>
<!-- CONTACT -->
<section id="contact" class="contact-section py-5 mt-5">
  <div class="container-xxl">
    <div class="row g-4">
      <div class="col-12 col-lg-6 mx-auto">
        <div class="card shadow-sm border-0 rounded-4">
          <div class="card-body p-4 p-lg-5">
            <h3 class="fw-bold mb-2">Contact us</h3>
            <p class="text-muted mb-4">
              Une question sur Simmo ou vos simulations de rentabilit√© ? √âcrivez-nous üëã
            </p>

            <form (ngSubmit)="submitContact()" #contactForm="ngForm" novalidate>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Nom</label>
                  <input class="form-control" name="name" [(ngModel)]="contact.name" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Email</label>
                  <input class="form-control" type="email" name="email"
                         [(ngModel)]="contact.email" required email />
                </div>
                <div class="col-12">
                  <label class="form-label">Message</label>
                  <textarea class="form-control" rows="5" name="message"
                            [(ngModel)]="contact.message" required></textarea>
                </div>
              </div>

              <div class="d-flex align-items-center gap-3 mt-4">
                <button class="btn btn-primary px-4"
                        type="submit"
                        [disabled]="contactForm.invalid || sendingContact">
                  <span *ngIf="!sendingContact">Envoyer</span>
                  <span *ngIf="sendingContact" class="spinner-border spinner-border-sm me-2"></span>
                </button>

                <div *ngIf="contactSent" class="text-success small">
                  <i class="bi bi-check2-circle me-1"></i> Message envoy√©. Merci !
                </div>
              </div>
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="app-footer mt-5">
  <div class="container-xxl py-4 d-flex flex-column flex-md-row
              justify-content-between align-items-center gap-3">
    <div class="text-muted">¬© {{ currentYear }} Simmo ‚Äî Tous droits r√©serv√©s.</div>
    <div class="d-flex gap-2">
      <a class="social" href="https://facebook.com" target="_blank" aria-label="Facebook">
        <i class="bi bi-facebook"></i>
      </a>
      <a class="social" href="https://twitter.com" target="_blank" aria-label="Twitter">
        <i class="bi bi-twitter"></i>
      </a>
      <a class="social" href="https://instagram.com" target="_blank" aria-label="Instagram">
        <i class="bi bi-instagram"></i>
      </a>
    </div>
  </div>
</footer>
